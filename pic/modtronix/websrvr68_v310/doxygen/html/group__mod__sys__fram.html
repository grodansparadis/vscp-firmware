<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SBC68EC Web Server: FRAM</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>FRAM<br>
<small>
[<a class="el" href="group__mod__sys.html">System Modules</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Files</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">file &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fram_8h.html">fram.h</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">FRAM Module for reading and writing from and to the FRAM. <br></td></tr>

<p>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This describes some routines provided for using the Ramtron FM25256/FM25640. These routines provide basic storage and retrieval of data, and also a modified version of the fsee file system is provided which has write support.<h2><a class="anchor" name="mod_sys_fram_intro">
Basic FRAM I/O</a></h2>
I developed the basic FRAM interface routines first. These provide the basic capability of reading and writing arbitrarily sized chunks of data to the FRAM at a specific location. They work somewhat like memcpy().<p>
If you use the FRAM routines, you must call <a class="el" href="fram_8h.html#670922e788c7dc4a484d16dea1db9721">FRAMInit()</a> once prior to use. This sets up the SPI parameters and IO pin directions.<p>
As-is, the code supports hardware SPI relevant for the SBC65EC. If for some reason you need a software SPI, there is an option on line 28 of FRAM.c which will cause a software implementation to be used. Also, the particular io pins are configured in the subsequent section if you are using a non-standard connection. Lastly, the clock speed may be changed at line 53. For the slower FM25640 you will need SPI_FOSC_16, and for the faster FM25656 the default of SPI_FOSC_4 will work.<p>
There are some additional sequential read and write routines. These were provided to ease porting of the file system and probably are of limited use otherwise. They leave the read or write transaction open so that multiple calls may be made to sequential addresses. There is a caveat that <a class="el" href="fram_8h.html#38cccecbfe7c5be51ecbf787e029e2a5">FRAMEndWrite()</a>/FRAMEndRead() must be called before relinquishing control back to the system because the ethernet controller shares the same IO pins. This is a little different than is with EE since those pins are dedicated.<h2><a class="anchor" name="mod_sys_fram_fs">
fsFRAM File System</a></h2>
Thinking it would be useful to someone, I made a modified version of <a class="el" href="fsee_8h.html" title="FSEE Module for Modtronix TCP/IP Stack.">fsee.h</a>, .c that implement the fsys interface via the FRAM io routines. Additionally, I provided implementation for the <a class="el" href="fs_8h.html#96ec02bc1f13abcee04828c0bbacdc70">filePutByte()</a> routine so that writing is possible. Writing continues from the current file position until end-of-file is reached.<h2><a class="anchor" name="mod_sys_fram_testing">
Testing</a></h2>
I used the out-of-box Modtronix web server as a development platform for testing. Strictly for testing purposes I modified the web server to only use the FRAM file system, not EE. This made it easy for me to exercise all the code. In real life you probably wouldn't want to do this as EE is perfectly fine for serving web pages.<p>
For testing I created a page experi.htm. This page is rewritten periodically and updated with the current tick count. This allowed me to easily see that file writing was working (in real life you would use cgi variables -- it was only a test).<p>
Some modifications were made to the project to coax it into using fsFRAM instead of fsee. The most interesting changes were made in mxwebsrvr.c, which is where the 'test suite' is executed. Modifications in that file include:<ul>
<li>Including appropriate headers</li><li>performing needed initialization calls</li><li>reading and writing test data on a periodic basis (once every 32 sec)</li></ul>
<p>
Modifications can be found by searching for the comment marker HHH.<h2><a class="anchor" name="mod_sys_fram_limitations">
Known Limitations</a></h2>
The sequential read and write methods in "fram.h" work fine, but you must complete the operation with FRAMEndRead/Write before relinquishing control to other tasks. This is because the IO pins are shared with other devices.<p>
The embedded file system on which fsee (and hence fsFRAM) are based is very simple, and several limitations are imposed by it's design:<ul>
<li>There is not a facility for dynamically allocating additional space for files after an image is built. This means you will need to anticipate the file size before hand. Do not compress it (or you will change it's real size of course).</li><li>You cannot create new files</li><li>You cannot delete old files</li><li>You cannot append to the end of a file</li></ul>
<p>
Despite it's limitations, fsee is fine for an embedded file system. I might implement a new file system with dynamic allocation, though it seems a bit much considering there is only 8-32k space to manage anyway. </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri May 14 08:54:23 2010 for SBC68EC Web Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
