<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SBC68EC Web Server: I2C Bus</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>I2C Bus<br>
<small>
[<a class="el" href="group__mod__buses.html">Serial Buses</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<h2><a class="anchor" name="mod_buses_busi2c_intro">
Introduction</a></h2>
This module makes the I2C bus available for writing and reading data to and from. The bus is configured at 400kbits/sec by default.<p>
All data written to the transmit buffer is decoded by this module, and will generally instruct data to be written, or read from a I2C slave node. An ASCII text based message protocol is used.<h2><a class="anchor" name="mod_buses_busi2c_protocol">
Message Protocol</a></h2>
Currently the following commands are defined:  
<table class=compactTable cellpadding=2 cellspacing=0 border=1>
<tr width="100%"><td align="center"><i><b>Command</b></i></td><td align="center"><i><b>Format</b></i></td><td align="center"><i><b>Description</b></i></td></tr>
<tr><td><b>0-9<br>A-F</b></td> <td><code>ASCII HEX</code></td>
    <td>A 8 bit value represented in ASCII HEX format.</td>
</tr>
<tr><td><b>S</b></td> <td><code>S</code></td>
    <td>Put a I2C Start condition on the bus.</td>
</tr>
<tr><td><b>P</b></td> <td><code>P</code></td>
    <td>Put a I2C Stop condition on the bus. This command returns the I2C bus to the idle state. You should always leave the bus 
    in this state when finished with a command.</td>
</tr>
<tr><td><b>R</b></td> <td><code>Rnn</code></td>
    <td>Reads given number of bytes from I2C slave node. Where 'nn' gives number of bytes to read in a 2 digit value.
    For example, <i>R05</i> will read 5 bytes from I2C bus.
  	The I2C bus can not be idle when issuing this command, and must be preceded by a S (I2C Start Condition) command.
    </td>
</tr>
<tr><td><b>W</b></td> <td><code>Wxx</code></td>
    <td>Writes a single byte to the I2C bus. Where "xx" represents a byte in two-digit upper case hex format.
    For example, <i>W1F</i> will write 0x1F (31 decimal) to the I2C bus.
  	The I2C bus can not be idle when issuing this command, and must be preceded by a S (I2C Start Condition) command.
    </td>
</tr>
</table>
<h2><a class="anchor" name="mod_buses_busi2c_read">
Reading from I2C bus</a></h2>
Each I2C node actually has two addresses. The even address is used to write to the node, and the odd address to read from it. Bit 0 (R/W bit) of the address byte is used to determine if a read or write command has to be executed. If 1, a I2C read is executed. To read, set bit 0 of the address. For example, accessing address 0x20 will write to the node, and address 0x21 will read from it.<h2><a class="anchor" name="mod_buses_busi2c_examples">
Examples</a></h2>
Following are some examples for communicating with nodes on the I2C bus. <br>
<b>Writing 0x10 to an I2C node with address 5A</b> <br>
<code><b>S5A10P</b></code> <br>
[I2C Start][Address:0x5A][Data:0x10][I2C Stop] <br>
This commands sends and I2C message, beginning with a I2C Start condition, and ending with an I2C stop condition.<p>
<br>
<b>Writing "Hello" to an I2C node with address 25</b> <br>
<code><b>S2548656C6C6FP</b></code> <br>
[I2C Start][Address:0x5A][Data:0x48, 0x65, 0x6C, 0x6C, ox6F][I2C Stop] <br>
This commands sends and I2C message, beginning with a I2C Start condition, and ending with an I2C stop condition. The ASCII string "Hello" is sent. Each character has to be sent with it's ASCII code.<p>
<br>
<b>Reading two bytes from an I2C node with address 51</b> <br>
<code><b>S5102P</b></code> <br>
[I2C Start][Address:0x51, R/W = Read][Number of bytes to read: 02][I2C Stop] <br>
This commands sends and I2C message, beginning with a I2C Start condition, and ending with an I2C stop condition. Two bytes are read from the I2C node with address 0x51 (or 0x50 for reading).<p>
<br>
<b>Repeated Start, write 1 byte (0x15), reading 3 bytes from an I2C node with address 2A (or 2B for writing)</b> <br>
<code><b>S2A15 S2B03P</b></code> <br>
[I2C Start][Address:0x2A, R/W = Write][Data: 0x15] [I2C Repeated Start][Address:0x2B, R/W = Read][Number of bytes to read: 03][I2C Stop] <br>
This commands uses the I2C repeated start feature. If a second start command is sent, without sending a stop command, it will cause a repeated start condition to be put on the I2C bus. A single byte is written to the I2C node with address 0x2A, and 3 bytes are read from the I2C node with address 0x2B. </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri May 14 08:54:23 2010 for SBC68EC Web Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
